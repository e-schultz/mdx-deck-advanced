import { Head, Appear, Image, withDeck } from 'mdx-deck'  // https://github.com/jxnblk/mdx-deck
import { CodeSurfer } from "mdx-deck-code-surfer"
import { FullScreenCode, Invert } from "mdx-deck/layouts";
import nightOwl from "prism-react-renderer/themes/nightOwl"
import ReplIt from "../../components/replit";
import  Code  from 'mdx-code';

# Promise Patterns  

---

## Promise Patterns - Parallel

- Finish in Any Order
- Promises Do Not Depend on the Success of Another 
- Only Care Once They All Finish 

---

## Promise Patterns - Waterfall

- Order Matters
- Another Request Needs the Result of a Previous 

---

## Promise Parallel - Promise.all

* Waits for All Promises to Resolve
* Gets Passed into the Handler as an Array

```javascript
let promiseA = someRequest("A");
let promiseB = someRequest("B");
let PromiseC = someRequest("C");

Promise.all([promiseA, promiseB, promiseC]).then(results => {
  console.log("Hello Results", results);
});
```

---
## Promise.all - Can Also Use Destructuring

- Waits for All Promises to Resolve
- Gets Passed into the Handler as an Array
- *note* : May need a polyfil for some browsers 

```javascript
let promiseA = someRequest("A");
let promiseB = someRequest("B");
let PromiseC = someRequest("C");

Promise.all([promiseA, promiseB, promiseC]).then(
  ([resultA, resultB, resultC]) => {
    console.log(resultA, resultB, resultC);
  }
);
```

---
## API Consideration 

<a href="https://js-ts-training.now.sh/" target="_blank">Simple API</a>

---

## Exercise Time: 

* Get a Game by ID
* Get a List of Platforms 
* Create a Game Object with the Game Name, and the Platform Name

```js
let expected = {
    id: 3,
    name: "Dragon Quest XI: Echoes of an Elusive Age",
    platformId: 1,
    platformName: "PS4"
  }

```
---
export default FullScreenCode

# Promise.all : Start

<ReplIt src="https://repl.it/@e_schultz/Promise-Parallel-Start?lite=true"/>

---
export default FullScreenCode

# Promise.all :  Solution

<ReplIt src="https://repl.it/@e_schultz/Promise-Parallel-Solution?lite=true"/>

```notes
<div style={{height: '80vh', display: 'block'}}>
    <iframe height="100%" style={{height: '100%'}} width="100%" src="https://repl.it/@e_schultz/Promise-Parallel-Solution?lite=true" scrolling="no" frameBorder="no"  allowFullScreen={true} sandbox="allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-modals">
    </iframe>
</div>
```
---
# Promise - Waterfall 

* Same API as Last Time
* Get Platform by Id, Instead of All Platforms 
* Request a Game
* Request the Platform for that Game
* Display same result with platformName in the result object:

```js
let expected = {
    id: 3,
    name: "Dragon Quest XI: Echoes of an Elusive Age",
    platformId: 1,
    platformName: "PS4"
  }

```

---
export default FullScreenCode

## Promise - One Request then Another

<ReplIt src="https://repl.it/@e_schultz/Promise-Waterfall-Start?lite=true"/>

---
export default FullScreenCode

## Promise - One Request then Another Solution

<ReplIt src="https://repl.it/@e_schultz/Promise-Waterfall-Solution?lite=true"/>

---

# Flatten Nested Promises

---
export default FullScreenCode

## Flattening The Chain .... take 1

<ReplIt src="https://repl.it/@e_schultz/Promise-Waterfall-Solution-Flat-Solution?lite=true"/>

---
export default FullScreenCode

## Flattening The Chain .... take 2 

<ReplIt src="https://repl.it/@e_schultz/Promise-Waterfall-Solution-Flat-Solution-Alt?lite=true"/>

---

# Advanced Promise Patterns 

---

## Promisify Synchronous Values

* Turn a Sync Value into an Async One
* Useful to Mock Data That Will Be Replaced with a Real Api Later
* Can Also Be Used as a Way to Cache a Value 

---
export default FullScreenCode

### Promisify Synchronous Values
<ReplIt src="https://repl.it/@e_schultz/Promisify-Sync-Data?lite=true"/>

```notes
const GAME_DATA = {
  1: { id: 1, name: 'God of War '},
  2: { id: 2, name: 'Octopath Traveler'},
  3: { id: 3, name: ' Dark Souls'},
}
function getGameData(id) {
  return GAME_DATA[id] ? Promise.resolve(GAME_DATA[id]) : Promise.reject('not found')
}

getGameData(1).then(n=>{
  console.log('found the game', n);
}).then(null,err=>{
  console.log('ooops', err)
});

getGameData(4).then(n=>{
  console.log('found the game', n);
}).then(null,err=>{
  console.log('ooops', err)
});
```
---

### Caching Async Data

* Promises Can Be Reused
* If You Store a Promise, and Return It Again - You Will Get the Previously Resolved Value

---
export default FullScreenCode

### Sync Cache Example

<ReplIt src="https://repl.it/@e_schultz/Sync-Cache-Example?lite=true"/>

---

### Promise Exercise - Cache the API Response 

* Check to See If a Game Has Been Requested Yet
* If so - Return the Cached Value
* If Not - Get the Value and Store It in the Cache 

---
export default FullScreenCode

### Promise Cache - Start

<ReplIt src="https://repl.it/@e_schultz/Promise-Cache-Exercise-start?lite=true"/>


---
export default FullScreenCode

### Promise Cache - Solution

<ReplIt src="https://repl.it/@e_schultz/Promise-Cache-Exercise-solution?lite=true"/>

---

### Promise Exercise - Bonus

* Make a Generic Cache for Any Fetch Request - Regardless of Games, Platform, Etc.
* How Would You Approach This?

---
### Promise Exercise - Bonus - Start 

export default FullScreenCode

<ReplIt src="https://repl.it/@e_schultz/Promise-Cache-Exercise-Bonus-Start?lite=true"/>

---
export default Invert 

# Break / Q&A

