import { FullScreenCode, Split, SplitRight } from "mdx-deck/layouts";
import ReplIt from "../../components/replit";
import CodeSandbox from "../../components/codesandbox";
import ImageSplit from "../../components/ImageSplit";
import Box from "../../components/Box";
import { Head, Appear, Image, withDeck } from 'mdx-deck'
import { CodeSurfer } from "mdx-deck-code-surfer"
import nightOwl from "prism-react-renderer/themes/nightOwl"
const BRANCH_NAME = 'master'; // tood: change before merge


# React State & Data Flow

---

## What is State?

* State is Data that changes over time

---

## React State

* React Components can have their own internal state
* Components should not directly mutate their state
* Children can not modify parent state

---

## Reading and Writing State

* The value of a component's state is modified using the `setState` method
* `setState` is only available on stateful components
* Component state can be accessed from the `state` object (`this.state`)

---

## Unidirectional Data Flow

* Data is passed down with props
* Callbacks are passed down and invoked to notify of changes
* Or Events are emitted

---

```
+------------------------------------+
|                                    |
| Parent                             |
|            Props        Callback   |
|              |             ^       |
|              |             |       |
|              |             |       |
|              Ë‡             |       |
|            +-------------------+   |
|            |Child              |   |
|            |                   |   |
|            |                   |   |
|            +-------------------+   |
|                                    |
+------------------------------------+

```
---

### How Can App Know What the Count Is?

* Children can not modify the `App` counter
* If App wants to keep track, how will it know?

```jsx
render() {
    return (
      <div className="App">
        <ul>
          <li>Hello World Count {this.state.helloWorldCount}</li>
        </ul>
        { /* How can App know about changes in HelloWorld? */ }>
        <HelloWorld/>
      </div>
    );
```
---

### How Can App Know What the Count Is?

* Remember: You can pass functions as props
* Pass a Callback to `HelloWorld`
* `HelloWorld` invokes it, `App` can respond to the change

---
export default FullScreenCode

### How Can App Know What the Count Is?

```jsx
handleCountChange(value) {
  this.setState({ helloWorldCount: value });
}
render() {
  return (
    <div className="App">
      <ul>
        <li>Hello World Count {this.state.helloWorldCount}</li>
      </ul>
      <HelloWorld onCountChange={this.handleCountChange} />
    </div>
    );
}
```
---

### Why?

* The Child can be reused in many contexts
* The Child can be reused more than once on the same screen
* Parent decides what to do with the change

---

### Why?

* You tell React when state changes with `setState`
* React does not automatically Observe or Dirty objects for you

---

```jsx
/* ..... */
  render() {
    return (
      <div className="App">
      First Hello World Clicked: {this.state.helloWorldOne}<br/>
      Second Hello World Clicked: {this.state.helloWorldTwo}<br/>

      <HelloWorld onValueChange={this.handleClickOne} />
      <HelloWorld onValueChange={this.handleClickTwo} />
      </div>
    );
  }
```

---

export default FullScreenCode

### Data Down, Callbacks Up

<CodeSandbox src={`https://codesandbox.io/embed/github/e-schultz/ts-js-react-training/tree/${BRANCH_NAME}/examples/react-data-down-events-up?autoresize=1&codemirror=1&fontsize=14&module=%2Fsrc%2Fcomponents%2FHelloWorld.js`}/>

---

## setState is Asynchronous

* Changes to state will not be available right away
* setState's second argument is a callback that can be used to avoid issues with this

---

## Without Callback

```jsx
handleCountChange(value) {
  this.setState({ helloWorldCount: value })
  // This will log the old value
  console.log(this.state.helloWorldCount)
}
```

---


## With Callback

```jsx
handleCountChange(value) {
  this.setState(
    { helloWorldCount: value },
    // This will log the new value
    () => { console.log(this.state.helloWorldCount) }
  )
}
```
